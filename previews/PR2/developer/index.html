<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Developer Guide · BoltzTraP.jl</title><meta name="title" content="Developer Guide · BoltzTraP.jl"/><meta property="og:title" content="Developer Guide · BoltzTraP.jl"/><meta property="twitter:title" content="Developer Guide · BoltzTraP.jl"/><meta name="description" content="Documentation for BoltzTraP.jl."/><meta property="og:description" content="Documentation for BoltzTraP.jl."/><meta property="twitter:description" content="Documentation for BoltzTraP.jl."/><meta property="og:url" content="https://hsugawa8651.github.io/BoltzTraP.jl/developer/"/><meta property="twitter:url" content="https://hsugawa8651.github.io/BoltzTraP.jl/developer/"/><link rel="canonical" href="https://hsugawa8651.github.io/BoltzTraP.jl/developer/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">BoltzTraP.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Guide</span><ul><li><a class="tocitem" href="../cli/">CLI Workflow</a></li><li><a class="tocitem" href="../workflow/">API Workflow</a></li><li><a class="tocitem" href="../dftk/">DFTK.jl Integration</a></li><li><a class="tocitem" href="../interpolate/">Interpolation</a></li><li><a class="tocitem" href="../integrate/">Integration</a></li><li><a class="tocitem" href="../plotting/">Plotting</a></li><li><a class="tocitem" href="../input_formats/">Input Formats</a></li><li><a class="tocitem" href="../output_formats/">Output Formats</a></li><li><a class="tocitem" href="../conventions/">Conventions</a></li><li><a class="tocitem" href="../ftest/">Functional Tests</a></li></ul></li><li><a class="tocitem" href="../validation/">Validation</a></li><li><a class="tocitem" href="../benchmarks/">Benchmarks</a></li><li><a class="tocitem" href="../reftest/">Reference Tests</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Developer Guide</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Developer Guide</a></li></ul></nav><div class="docs-right"><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Developer-Guide"><a class="docs-heading-anchor" href="#Developer-Guide">Developer Guide</a><a id="Developer-Guide-1"></a><a class="docs-heading-anchor-permalink" href="#Developer-Guide" title="Permalink"></a></h1><p>This page documents internal data structures, types, and workflows for developers extending BoltzTraP.jl.</p><p>For validating results against Python BoltzTraP2, see the <a href="../validation/">Validation</a> page.</p><h2 id="Architecture-Overview"><a class="docs-heading-anchor" href="#Architecture-Overview">Architecture Overview</a><a id="Architecture-Overview-1"></a><a class="docs-heading-anchor-permalink" href="#Architecture-Overview" title="Permalink"></a></h2><pre><code class="nohighlight hljs">┌─────────────────────────────────────────────────────────────┐
│                      Public API                              │
│  run_interpolate, run_integrate, load_vasp, load_qe, ...    │
└─────────────────────────────────────────────────────────────┘
                              │
┌─────────────────────────────────────────────────────────────┐
│                    Workflow Layer                            │
│  workflow.jl: orchestrates interpolation and integration    │
└─────────────────────────────────────────────────────────────┘
                              │
┌──────────────┬──────────────┬──────────────┬────────────────┐
│   Symmetry   │ Interpolation│ Reconstruction│   Transport   │
│  sphere.jl   │interpolation │reconstruction │  bandlib.jl   │
│ symmetry.jl  │    .jl       │    .jl        │               │
│equivalences.jl│             │               │               │
└──────────────┴──────────────┴──────────────┴────────────────┘
                              │
┌─────────────────────────────────────────────────────────────┐
│                      I/O Layer                               │
│  io/vasp.jl, io/qe.jl, io/serialization.jl, io/loader.jl   │
└─────────────────────────────────────────────────────────────┘</code></pre><h2 id="Core-Data-Types"><a class="docs-heading-anchor" href="#Core-Data-Types">Core Data Types</a><a id="Core-Data-Types-1"></a><a class="docs-heading-anchor-permalink" href="#Core-Data-Types" title="Permalink"></a></h2><h3 id="InterpolationResult"><a class="docs-heading-anchor" href="#InterpolationResult">InterpolationResult</a><a id="InterpolationResult-1"></a><a class="docs-heading-anchor-permalink" href="#InterpolationResult" title="Permalink"></a></h3><p>Stores the result of band structure interpolation.</p><pre><code class="language-julia hljs">struct InterpolationResult
    coeffs::Matrix{ComplexF64}       # Fourier coefficients (nbands × neq)
    equivalences::Vector{Matrix{Int}} # Equivalence class representatives
    lattvec::Matrix{Float64}         # Lattice vectors (3×3, Bohr)
    atoms::Union{Nothing,Dict}       # Atomic structure (optional)
    metadata::Dict{String,Any}       # Additional information
end</code></pre><p><strong>Metadata keys:</strong></p><ul><li><code>fermi</code>: Fermi energy (Ha)</li><li><code>nelect</code>: Number of electrons</li><li><code>dosweight</code>: DOS weight (2.0 for non-spin-polarized)</li><li><code>selected_bands</code>: Band indices used</li><li><code>spacegroup_number</code>, <code>spacegroup_symbol</code>: Space group info</li></ul><h3 id="IntegrateResult"><a class="docs-heading-anchor" href="#IntegrateResult">IntegrateResult</a><a id="IntegrateResult-1"></a><a class="docs-heading-anchor-permalink" href="#IntegrateResult" title="Permalink"></a></h3><p>Stores transport coefficients from BZ integration.</p><pre><code class="language-julia hljs">struct IntegrateResult
    temperatures::Vector{Float64}    # Temperatures (K)
    mu_values::Vector{Float64}       # Chemical potentials (eV)
    sigma::Array{Float64,4}          # Conductivity (3×3×nT×nμ), S/m
    seebeck::Array{Float64,4}        # Seebeck (3×3×nT×nμ), V/K
    kappa::Array{Float64,4}          # Thermal conductivity (3×3×nT×nμ), W/(m·K)
    dos::Union{Nothing,Dict}         # DOS data (optional)
    metadata::Dict{String,Any}       # Additional information
end</code></pre><h3 id="FourierInterpolator"><a class="docs-heading-anchor" href="#FourierInterpolator">FourierInterpolator</a><a id="FourierInterpolator-1"></a><a class="docs-heading-anchor-permalink" href="#FourierInterpolator" title="Permalink"></a></h3><p>Internal type for band interpolation (not exported).</p><pre><code class="language-julia hljs">struct FourierInterpolator
    coeffs::Matrix{ComplexF64}       # Fourier coefficients
    equivalences::Vector{Vector{SVector{3,Int}}}  # Equivalence classes
    lattvec::SMatrix{3,3,Float64}    # Lattice vectors
end</code></pre><p><strong>Key methods:</strong></p><ul><li><code>interpolate_bands(interp, kpoints)</code> → band energies</li><li><code>interpolate_velocities(interp, kpoints)</code> → band velocities</li></ul><h2 id="I/O-Data-Format"><a class="docs-heading-anchor" href="#I/O-Data-Format">I/O Data Format</a><a id="I/O-Data-Format-1"></a><a class="docs-heading-anchor-permalink" href="#I/O-Data-Format" title="Permalink"></a></h2><p>All loaders (<code>load_vasp</code>, <code>load_qe</code>, <code>load_dftk</code>) return a NamedTuple:</p><pre><code class="language-julia hljs">(
    lattice::Matrix{Float64},     # 3×3, Bohr
    positions::Matrix{Float64},   # 3×natoms, fractional
    species::Vector{String},      # Element symbols
    kpoints::Matrix{Float64},     # 3×nkpts, fractional
    weights::Vector{Float64},     # nkpts
    ebands::Array{Float64,3},     # nbands×nkpts×nspin, Hartree
    occupations::Array{Float64,3},# nbands×nkpts×nspin
    fermi::Float64,               # Hartree
    nelect::Float64,              # Number of electrons
)</code></pre><h2 id="Internal-Functions"><a class="docs-heading-anchor" href="#Internal-Functions">Internal Functions</a><a id="Internal-Functions-1"></a><a class="docs-heading-anchor-permalink" href="#Internal-Functions" title="Permalink"></a></h2><h3 id="Sphere-Module-(sphere.jl)"><a class="docs-heading-anchor" href="#Sphere-Module-(sphere.jl)">Sphere Module (<code>sphere.jl</code>)</a><a id="Sphere-Module-(sphere.jl)-1"></a><a class="docs-heading-anchor-permalink" href="#Sphere-Module-(sphere.jl)" title="Permalink"></a></h3><table><tr><th style="text-align: right">Function</th><th style="text-align: right">Description</th></tr><tr><td style="text-align: right"><code>compute_bounds(lattvec, radius)</code></td><td style="text-align: right">Compute search bounds for lattice points</td></tr><tr><td style="text-align: right"><code>compute_radius(lattvec, nrot, nkpt_target)</code></td><td style="text-align: right">Estimate radius for target k-points</td></tr><tr><td style="text-align: right"><code>calc_nrotations(lattvec, positions, types, magmom)</code></td><td style="text-align: right">Count symmetry operations</td></tr><tr><td style="text-align: right"><code>get_unique_rotations(...)</code></td><td style="text-align: right">Get unique rotation matrices</td></tr><tr><td style="text-align: right"><code>calc_tensor_basis(...)</code></td><td style="text-align: right">Compute symmetry-adapted tensor basis</td></tr></table><h3 id="Equivalences-Module-(equivalences.jl)"><a class="docs-heading-anchor" href="#Equivalences-Module-(equivalences.jl)">Equivalences Module (<code>equivalences.jl</code>)</a><a id="Equivalences-Module-(equivalences.jl)-1"></a><a class="docs-heading-anchor-permalink" href="#Equivalences-Module-(equivalences.jl)" title="Permalink"></a></h3><table><tr><th style="text-align: right">Function</th><th style="text-align: right">Description</th></tr><tr><td style="text-align: right"><code>calc_sphere_quotient_set(...)</code></td><td style="text-align: right">Compute equivalence classes</td></tr><tr><td style="text-align: right"><code>lattice_points_in_sphere(...)</code></td><td style="text-align: right">Find lattice points within radius</td></tr></table><h3 id="Interpolation-Module-(interpolation.jl)"><a class="docs-heading-anchor" href="#Interpolation-Module-(interpolation.jl)">Interpolation Module (<code>interpolation.jl</code>)</a><a id="Interpolation-Module-(interpolation.jl)-1"></a><a class="docs-heading-anchor-permalink" href="#Interpolation-Module-(interpolation.jl)" title="Permalink"></a></h3><table><tr><th style="text-align: right">Function</th><th style="text-align: right">Description</th></tr><tr><td style="text-align: right"><code>compute_phase_factors(kpoints, equivalences)</code></td><td style="text-align: right">Compute exp(2πi k·R)</td></tr><tr><td style="text-align: right"><code>FourierInterpolator(kpts, ebands, equivs, lattvec)</code></td><td style="text-align: right">Fit Fourier coefficients</td></tr><tr><td style="text-align: right"><code>interpolate_bands(interp, kpoints)</code></td><td style="text-align: right">Evaluate bands at k-points</td></tr><tr><td style="text-align: right"><code>interpolate_velocities(interp, kpoints)</code></td><td style="text-align: right">Evaluate velocities</td></tr></table><h3 id="Transport-Module-(bandlib.jl)"><a class="docs-heading-anchor" href="#Transport-Module-(bandlib.jl)">Transport Module (<code>bandlib.jl</code>)</a><a id="Transport-Module-(bandlib.jl)-1"></a><a class="docs-heading-anchor-permalink" href="#Transport-Module-(bandlib.jl)" title="Permalink"></a></h3><table><tr><th style="text-align: right">Function</th><th style="text-align: right">Description</th></tr><tr><td style="text-align: right"><code>fermi_dirac(ε, μ, kT)</code></td><td style="text-align: right">Fermi-Dirac distribution</td></tr><tr><td style="text-align: right"><code>dfermi_dirac_de(ε, μ, kT)</code></td><td style="text-align: right">Derivative of f(E)</td></tr><tr><td style="text-align: right"><code>calc_Onsager_coefficients(...)</code></td><td style="text-align: right">Compute L0, L1, L2 tensors</td></tr><tr><td style="text-align: right"><code>calc_transport_coefficients(...)</code></td><td style="text-align: right">Compute σ, S, κ from Onsager</td></tr><tr><td style="text-align: right"><code>calc_N(...)</code></td><td style="text-align: right">Carrier concentration</td></tr><tr><td style="text-align: right"><code>solve_for_mu(...)</code></td><td style="text-align: right">Find μ for target carrier density</td></tr></table><h2 id="Unit-Constants-(units.jl)"><a class="docs-heading-anchor" href="#Unit-Constants-(units.jl)">Unit Constants (<code>units.jl</code>)</a><a id="Unit-Constants-(units.jl)-1"></a><a class="docs-heading-anchor-permalink" href="#Unit-Constants-(units.jl)" title="Permalink"></a></h2><pre><code class="language-julia hljs">const BOHR_TO_ANG = 0.529177210903     # Length conversion
const ANG_TO_BOHR = 1 / BOHR_TO_ANG
const HA_TO_EV = 27.211386245988       # Energy conversion
const EV_TO_HA = 1 / HA_TO_EV
const KB_AU = 3.1668115634438576e-6    # Boltzmann constant (Ha/K)
const SIGMA_CONV = 5.2586177987809155e-24   # σ/τ: S/(m·s)
const SEEBECK_CONV = 1.9325063968640632e-25 # S intermediate
const KAPPA_CONV = 7.101830018500863e-27    # κ/τ: W/(m·K·s)</code></pre><h2 id="Adding-New-Features"><a class="docs-heading-anchor" href="#Adding-New-Features">Adding New Features</a><a id="Adding-New-Features-1"></a><a class="docs-heading-anchor-permalink" href="#Adding-New-Features" title="Permalink"></a></h2><h3 id="Adding-a-New-I/O-Format"><a class="docs-heading-anchor" href="#Adding-a-New-I/O-Format">Adding a New I/O Format</a><a id="Adding-a-New-I/O-Format-1"></a><a class="docs-heading-anchor-permalink" href="#Adding-a-New-I/O-Format" title="Permalink"></a></h3><ol><li>Create <code>src/io/newformat.jl</code>:</li></ol><pre><code class="language-julia hljs">function load_newformat(directory::String)
    # Parse files and return NamedTuple
    return (
        lattice = ...,   # 3×3, Bohr
        kpoints = ...,   # 3×nkpts, fractional
        ebands = ...,    # nbands×nkpts×nspin, Hartree
        fermi = ...,     # Hartree
        # ... other fields
    )
end</code></pre><ol><li>Register in <code>src/io/loader.jl</code>:</li></ol><pre><code class="language-julia hljs">function _detect_newformat(directory::String)
    isfile(joinpath(directory, &quot;newformat.out&quot;))
end

# In _init_loaders():
register_loader(&quot;NewFormat&quot;, _detect_newformat, load_newformat)</code></pre><ol><li>Export in <code>src/BoltzTraP.jl</code>:</li></ol><pre><code class="language-julia hljs">export load_newformat</code></pre><h3 id="Adding-a-New-Transport-Property"><a class="docs-heading-anchor" href="#Adding-a-New-Transport-Property">Adding a New Transport Property</a><a id="Adding-a-New-Transport-Property-1"></a><a class="docs-heading-anchor-permalink" href="#Adding-a-New-Transport-Property" title="Permalink"></a></h3><ol><li>Add calculation in <code>src/bandlib.jl</code></li><li>Add to <code>IntegrateResult</code> struct in <code>src/io/serialization.jl</code></li><li>Update <code>run_integrate</code> in <code>src/workflow.jl</code></li><li>Add CLI option in <code>src/cli.jl</code> (if needed)</li></ol><h2 id="Debugging"><a class="docs-heading-anchor" href="#Debugging">Debugging</a><a id="Debugging-1"></a><a class="docs-heading-anchor-permalink" href="#Debugging" title="Permalink"></a></h2><h3 id="CLI-Debug-Mode"><a class="docs-heading-anchor" href="#CLI-Debug-Mode">CLI Debug Mode</a><a id="CLI-Debug-Mode-1"></a><a class="docs-heading-anchor-permalink" href="#CLI-Debug-Mode" title="Permalink"></a></h3><p>Use the <code>--debug</code> flag to enable detailed logging output:</p><pre><code class="language-bash hljs"># Interpolation with debug output
boltztrap interpolate ./Si.vasp --debug

# Integration with debug output
boltztrap integrate si_interp.jld2 -t 300 --debug</code></pre><p>Debug output includes:</p><ul><li>CLI argument values received</li><li>DFT format detection process</li><li>File loading details</li><li>Workflow function parameters</li></ul><h3 id="Environment-Variable"><a class="docs-heading-anchor" href="#Environment-Variable">Environment Variable</a><a id="Environment-Variable-1"></a><a class="docs-heading-anchor-permalink" href="#Environment-Variable" title="Permalink"></a></h3><p>Alternatively, set the <code>JULIA_DEBUG</code> environment variable:</p><pre><code class="language-bash hljs">JULIA_DEBUG=BoltzTraP boltztrap interpolate ./Si.vasp</code></pre><p>Or in Julia:</p><pre><code class="language-julia hljs">ENV[&quot;JULIA_DEBUG&quot;] = &quot;BoltzTraP&quot;
using BoltzTraP
# Now all @debug statements will be printed</code></pre><h3 id="Logging-Levels"><a class="docs-heading-anchor" href="#Logging-Levels">Logging Levels</a><a id="Logging-Levels-1"></a><a class="docs-heading-anchor-permalink" href="#Logging-Levels" title="Permalink"></a></h3><p>BoltzTraP.jl uses Julia&#39;s standard <code>Logging</code> module:</p><table><tr><th style="text-align: right">Level</th><th style="text-align: right">Purpose</th><th style="text-align: right">Enabled by</th></tr><tr><td style="text-align: right"><code>@debug</code></td><td style="text-align: right">Internal details, argument values</td><td style="text-align: right"><code>--debug</code> flag</td></tr><tr><td style="text-align: right"><code>@info</code></td><td style="text-align: right">Success messages</td><td style="text-align: right">Always</td></tr><tr><td style="text-align: right"><code>@warn</code></td><td style="text-align: right">Non-fatal issues</td><td style="text-align: right">Always</td></tr><tr><td style="text-align: right"><code>@error</code></td><td style="text-align: right">Fatal errors</td><td style="text-align: right">Always</td></tr></table><h3 id="Verbose-Mode-vs-Debug-Mode"><a class="docs-heading-anchor" href="#Verbose-Mode-vs-Debug-Mode">Verbose Mode vs Debug Mode</a><a id="Verbose-Mode-vs-Debug-Mode-1"></a><a class="docs-heading-anchor-permalink" href="#Verbose-Mode-vs-Debug-Mode" title="Permalink"></a></h3><table><tr><th style="text-align: right">Flag</th><th style="text-align: right">Output</th><th style="text-align: right">Audience</th></tr><tr><td style="text-align: right"><code>-v, --verbose</code></td><td style="text-align: right">Progress messages via <code>println</code></td><td style="text-align: right">End users</td></tr><tr><td style="text-align: right"><code>--debug</code></td><td style="text-align: right">Internal state via <code>@debug</code></td><td style="text-align: right">Developers</td></tr></table><p>Example with both:</p><pre><code class="language-bash hljs">boltztrap interpolate ./Si.vasp -v --debug</code></pre><h2 id="Reference-Tests-(reftest)"><a class="docs-heading-anchor" href="#Reference-Tests-(reftest)">Reference Tests (reftest)</a><a id="Reference-Tests-(reftest)-1"></a><a class="docs-heading-anchor-permalink" href="#Reference-Tests-(reftest)" title="Permalink"></a></h2><p>BoltzTraP.jl includes 75 reference tests that validate numerical equivalence with Python BoltzTraP2. These tests compare Julia output against pre-computed Python reference data.</p><p>For complete documentation on running and extending reference tests, see the dedicated <strong><a href="../reftest/">Reference Tests</a></strong> page.</p><p>Quick start:</p><pre><code class="language-bash hljs"># Generate reference data (requires Python BoltzTraP2)
cd reftest
pip install boltztrap2
python generate_1_sphere.py
python generate_2_interpolation_si.py
# ... (see reftest.md for full list)

# Run tests
cd ..
julia --project -e &#39;using Pkg; Pkg.test()&#39;</code></pre><h2 id="Functional-Tests-(ftest)"><a class="docs-heading-anchor" href="#Functional-Tests-(ftest)">Functional Tests (ftest)</a><a id="Functional-Tests-(ftest)-1"></a><a class="docs-heading-anchor-permalink" href="#Functional-Tests-(ftest)" title="Permalink"></a></h2><p>Functional tests are located in the <code>ftest/</code> directory. Unlike unit tests in <code>test/</code>, these are standalone scripts for manual verification and debugging.</p><h3 id="Available-Tests"><a class="docs-heading-anchor" href="#Available-Tests">Available Tests</a><a id="Available-Tests-1"></a><a class="docs-heading-anchor-permalink" href="#Available-Tests" title="Permalink"></a></h3><table><tr><th style="text-align: right">File</th><th style="text-align: right">Purpose</th></tr><tr><td style="text-align: right"><code>test_cli_all_options.jl</code></td><td style="text-align: right">Comprehensive test of all CLI options</td></tr><tr><td style="text-align: right"><code>test_cli_args.jl</code></td><td style="text-align: right">Basic argument propagation test</td></tr><tr><td style="text-align: right"><code>test_format_detection.jl</code></td><td style="text-align: right">DFT format auto-detection test</td></tr></table><h3 id="Running-Functional-Tests"><a class="docs-heading-anchor" href="#Running-Functional-Tests">Running Functional Tests</a><a id="Running-Functional-Tests-1"></a><a class="docs-heading-anchor-permalink" href="#Running-Functional-Tests" title="Permalink"></a></h3><pre><code class="language-bash hljs"># Run from project root
cd BoltzTraP.jl

# Test all CLI options (requires VASP test data)
julia --project=. ftest/test_cli_all_options.jl

# With custom data directory
julia --project=. ftest/test_cli_all_options.jl /path/to/vasp/dir

# Test format detection
julia --project=. ftest/test_format_detection.jl

# With debug output
JULIA_DEBUG=BoltzTraP julia --project=. ftest/test_cli_args.jl</code></pre><h3 id="Test-Data"><a class="docs-heading-anchor" href="#Test-Data">Test Data</a><a id="Test-Data-1"></a><a class="docs-heading-anchor-permalink" href="#Test-Data" title="Permalink"></a></h3><p>Functional tests expect VASP data in <code>../BoltzTraP2-public/data/Si.vasp/</code> by default. You can specify a different directory as a command-line argument.</p><p>Required files:</p><pre><code class="nohighlight hljs">vasp_directory/
└── vasprun.xml</code></pre><h3 id="Writing-New-Functional-Tests"><a class="docs-heading-anchor" href="#Writing-New-Functional-Tests">Writing New Functional Tests</a><a id="Writing-New-Functional-Tests-1"></a><a class="docs-heading-anchor-permalink" href="#Writing-New-Functional-Tests" title="Permalink"></a></h3><p>Template for a new functional test:</p><pre><code class="language-julia hljs"># ftest/test_new_feature.jl
using Logging

# Enable debug logging
ENV[&quot;JULIA_DEBUG&quot;] = &quot;BoltzTraP&quot;
global_logger(ConsoleLogger(stderr, Logging.Debug))

using BoltzTraP

function main()
    println(&quot;=&quot; ^ 60)
    println(&quot;Functional Test: New Feature&quot;)
    println(&quot;=&quot; ^ 60)

    # Test 1
    println(&quot;-&quot; ^ 60)
    println(&quot;Test 1: Description&quot;)
    println(&quot;-&quot; ^ 60)
    @info &quot;Running test 1&quot;

    # ... test code ...

    @assert condition &quot;Error message&quot;
    println(&quot;  ✓ PASS&quot;)

    println(&quot;=&quot; ^ 60)
    println(&quot;All tests passed!&quot;)
    println(&quot;=&quot; ^ 60)
end

main()</code></pre><h2 id="DFT-Format-Auto-Detection"><a class="docs-heading-anchor" href="#DFT-Format-Auto-Detection">DFT Format Auto-Detection</a><a id="DFT-Format-Auto-Detection-1"></a><a class="docs-heading-anchor-permalink" href="#DFT-Format-Auto-Detection" title="Permalink"></a></h2><h3 id="How-It-Works"><a class="docs-heading-anchor" href="#How-It-Works">How It Works</a><a id="How-It-Works-1"></a><a class="docs-heading-anchor-permalink" href="#How-It-Works" title="Permalink"></a></h3><p>The CLI uses <code>load_dft()</code> to automatically detect the DFT format:</p><ol><li>Try each registered loader in reverse order (VASP first, then QE)</li><li>Each loader has a detector function that checks for format-specific files</li><li>First successful detection wins</li></ol><h3 id="Detector-Functions"><a class="docs-heading-anchor" href="#Detector-Functions">Detector Functions</a><a id="Detector-Functions-1"></a><a class="docs-heading-anchor-permalink" href="#Detector-Functions" title="Permalink"></a></h3><table><tr><th style="text-align: right">Format</th><th style="text-align: right">Detection</th></tr><tr><td style="text-align: right">VASP</td><td style="text-align: right"><code>vasprun.xml</code> exists in directory</td></tr><tr><td style="text-align: right">QE</td><td style="text-align: right"><code>*.save/data-file-schema.xml</code> or <code>*.save/data-file.xml</code> exists</td></tr></table><h3 id="Forcing-a-Format"><a class="docs-heading-anchor" href="#Forcing-a-Format">Forcing a Format</a><a id="Forcing-a-Format-1"></a><a class="docs-heading-anchor-permalink" href="#Forcing-a-Format" title="Permalink"></a></h3><p>Use <code>--format</code> to skip auto-detection:</p><pre><code class="language-bash hljs">boltztrap interpolate ./data -f vasp  # Force VASP
boltztrap interpolate ./data -f qe    # Force QE
boltztrap interpolate ./data -f auto  # Auto-detect (default)</code></pre><h3 id="Adding-a-New-Format"><a class="docs-heading-anchor" href="#Adding-a-New-Format">Adding a New Format</a><a id="Adding-a-New-Format-1"></a><a class="docs-heading-anchor-permalink" href="#Adding-a-New-Format" title="Permalink"></a></h3><ol><li>Create loader in <code>src/io/newformat.jl</code></li><li>Register in <code>src/io/loader.jl</code>:</li></ol><pre><code class="language-julia hljs">function _detect_newformat(directory::String)
    # Return true if format detected
    isfile(joinpath(directory, &quot;newformat.out&quot;))
end

# In _init_loaders():
register_loader(&quot;NewFormat&quot;, _detect_newformat, load_newformat)</code></pre><h2 id="Code-Structure"><a class="docs-heading-anchor" href="#Code-Structure">Code Structure</a><a id="Code-Structure-1"></a><a class="docs-heading-anchor-permalink" href="#Code-Structure" title="Permalink"></a></h2><pre><code class="nohighlight hljs">src/
├── cli.jl              # CLI commands (Comonicon)
├── workflow.jl         # High-level workflows with @debug logging
├── io/
│   ├── loader.jl       # Auto-detection logic
│   ├── vasp.jl         # VASP loader
│   └── qe.jl           # QE loader
└── ...

ftest/                  # Functional tests (manual)
test/                   # Unit tests (automated)</code></pre><h2 id="Troubleshooting"><a class="docs-heading-anchor" href="#Troubleshooting">Troubleshooting</a><a id="Troubleshooting-1"></a><a class="docs-heading-anchor-permalink" href="#Troubleshooting" title="Permalink"></a></h2><h3 id="&quot;No-compatible-DFT-format-found&quot;"><a class="docs-heading-anchor" href="#&quot;No-compatible-DFT-format-found&quot;">&quot;No compatible DFT format found&quot;</a><a id="&quot;No-compatible-DFT-format-found&quot;-1"></a><a class="docs-heading-anchor-permalink" href="#&quot;No-compatible-DFT-format-found&quot;" title="Permalink"></a></h3><ol><li>Check directory path is correct</li><li>Run with <code>--debug</code> to see detection attempts</li><li>Try explicit format: <code>--format vasp</code></li><li>Verify required files exist (e.g., <code>vasprun.xml</code>)</li></ol><h3 id="Debug-Output-Not-Showing"><a class="docs-heading-anchor" href="#Debug-Output-Not-Showing">Debug Output Not Showing</a><a id="Debug-Output-Not-Showing-1"></a><a class="docs-heading-anchor-permalink" href="#Debug-Output-Not-Showing" title="Permalink"></a></h3><ol><li>Ensure <code>--debug</code> is passed to the command</li><li>Or set <code>ENV[&quot;JULIA_DEBUG&quot;] = &quot;BoltzTraP&quot;</code> before <code>using BoltzTraP</code></li><li>Check stderr (debug goes to stderr, not stdout)</li></ol><h3 id="Functional-Test-Failures"><a class="docs-heading-anchor" href="#Functional-Test-Failures">Functional Test Failures</a><a id="Functional-Test-Failures-1"></a><a class="docs-heading-anchor-permalink" href="#Functional-Test-Failures" title="Permalink"></a></h3><ol><li>Check test data path exists</li><li>Run with debug logging enabled</li><li>Check assertion error messages for details</li></ol><h2 id="Migration-Guide"><a class="docs-heading-anchor" href="#Migration-Guide">Migration Guide</a><a id="Migration-Guide-1"></a><a class="docs-heading-anchor-permalink" href="#Migration-Guide" title="Permalink"></a></h2><h3 id="v0.2-(upcoming):-Magnetic-Material-Support"><a class="docs-heading-anchor" href="#v0.2-(upcoming):-Magnetic-Material-Support">v0.2 (upcoming): Magnetic Material Support</a><a id="v0.2-(upcoming):-Magnetic-Material-Support-1"></a><a class="docs-heading-anchor-permalink" href="#v0.2-(upcoming):-Magnetic-Material-Support" title="Permalink"></a></h3><p>The <code>spintype</code> metadata field has been added to both <code>InterpolationResult</code> and <code>IntegrateResult</code> to prepare for magnetic material support in v0.2.</p><p><strong>Current behavior (v0.1):</strong></p><ul><li>All calculations assume non-magnetic (unpolarized) materials</li><li><code>metadata[&quot;spintype&quot;]</code> = <code>&quot;Unpolarized&quot;</code> (always)</li></ul><p><strong>Planned v0.2 changes:</strong></p><ul><li><code>SpinType</code> enum: <code>Unpolarized</code>, <code>Collinear</code>, <code>NonCollinear</code></li><li>Parametric types: <code>InterpolationResult{ST}</code> where <code>ST&lt;:SpinType</code></li><li>Spin-polarized VASP/QE support</li></ul><p><strong>Forward compatibility:</strong> Files saved with v0.1 will be loadable in v0.2. The <code>spintype</code> metadata field ensures smooth migration.</p></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Wednesday 21 January 2026 16:00">Wednesday 21 January 2026</span>. Using Julia version 1.10.10.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
